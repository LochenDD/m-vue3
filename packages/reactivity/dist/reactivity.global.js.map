{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { reactive } from './reactive'\nexport { effect } from './effect'", "export const isObject=(value) => {\n    return typeof value === 'object' && value !== null;\n}\n", "let activeEffect = undefined\n\n// \u6E05\u7A7A\u5F53\u524Deffect\nconst cleanupEffect = (effect) => {\n    const { deps } = effect\n    deps.forEach(dep => {\n        dep.delete(effect)\n    })\n    effect.deps.length = 0\n}\n\nclass ReactiveEffect {\n    // \u7236\u7EA7effect \u5904\u7406\u5D4C\u5957effect\u60C5\u51B5\n    public parent = null;\n    // \u5F53\u524Deffect\u662F\u5426\u6FC0\u6D3B\n    public active = true\n    // \u5C5E\u6027\u5BF9\u5E94effect\u5408\u96C6\u4E2D\u6709\u5F53\u524Deffect\u7684\u6240\u6709Set \u7C7B\u578B: [Set, Set]\n    public deps = []\n    constructor(public fn, public scheduler) {}\n\n    run() {\n        if (!this.active) {\n            this.fn()\n            return\n        }\n        try {\n            this.parent = activeEffect\n            activeEffect = this\n            // \u6267\u884C\u91CD\u65B0\u6E32\u67D3\u4E4B\u524D \u6E05\u7A7A\u4E4B\u524D\u6536\u96C6\u7684\u5F53\u524Deffect \u8BA9\u6709\u5206\u652F\u8BED\u53E5\u7684effect\u6B63\u786E\u6536\u96C6\u4F9D\u8D56  \u4F8B\u5982: state.flag ? state.name : state.name\n            cleanupEffect(this)\n            // \u6267\u884Cfn \u91CD\u65B0\u6536\u96C6\u5F53\u524Deffect\u4F9D\u8D56\n            return this.fn()\n        } finally {\n            activeEffect = this.parent\n            this.parent = null\n        }\n    }\n    stop() {\n        if (!this.active) {\n            this.active = false\n        }\n        cleanupEffect(this)\n    }\n}\n\n\nexport const effect = (fn, options: any = {}) => {\n    const _effect = new ReactiveEffect(fn, options.scheduler);\n    _effect.run()\n    const runner = _effect.run.bind(_effect)\n    runner.effect = _effect\n    return runner\n}\n\n// { \u5BF9\u8C61: Map{ \u5C5E\u6027: Set[ effects ] } } \u5B58\u653E\u54CD\u5E94\u5F0F\u5BF9\u8C61\u5C5E\u6027\u548Ceffect\u7684\u5BF9\u5E94\u5173\u7CFB\nconst targetMap = new WeakMap()\n\n// \u8BFB\u53D6\u54CD\u5E94\u5F0F\u5BF9\u8C61\u5C5E\u6027\u65F6\u8FD0\u884C\nexport const track = (target, type, key) => {\n    if (!activeEffect) {\n        return\n    }\n    // \u5B58\u653E\u5BF9\u8C61\u5185\u548C\n    let depsMap = targetMap.get(target)\n    if (!depsMap) {\n        // (depsMap = new Map()) \u5148\u8D4B\u503C\u540E\u5C06depsMap\u53D8\u91CF\u4F5C\u4E3A\u503C\u653E\u5728\u8FD9\u4E2A\u5730\u65B9\n        targetMap.set(target, (depsMap = new Map()))\n    } \n    // \u5B58\u653Eeffect\u7684\u5408\u96C6 \u662F\u4E2ASet\n    let dep = depsMap.get(key)\n    if (!dep) {\n        depsMap.set(key, (dep = new Set()))\n    }\n    const shouldTrack = !dep.has(activeEffect)\n    if (shouldTrack) {\n        dep.add(activeEffect)\n        activeEffect.deps.push(dep)\n    }\n}\n\nexport const trigger = (target, type, key, value, oldValue) => {\n    const depsMap = targetMap.get(target)\n    if (!depsMap) {\n        return\n    }\n    let effects = depsMap.get(key)\n    effects = new Set(effects)\n    effects && effects.forEach(effect => {\n        if (effect !== activeEffect) {\n            if (effect.scheduler) {\n                effect.scheduler()\n            } else {\n                effect.run()\n            }\n        }\n    })\n}", "import { isObject } from '@vue/shared'\nimport { track, trigger } from './effect'\nimport { reactive } from './reactive'\n\nexport const enum ReactiveFlags {\n    // \u6807\u5FD7\u4F4D \u4EE3\u8868\u5DF2\u88ABreactive\u4EE3\u7406\n    IS_REACTIVE = '__v_isReactive'\n}\n\nexport const mutableHandler = {\n    get(target, key, receiver) {\n        if (key === ReactiveFlags.IS_REACTIVE) {\n            return true\n        }\n        track(target, 'get', key)\n        // \u4E3A\u4E86\u80FD\u5728\u53D6\u5BF9\u8C61\u7684getter\u65F6\u80FD\u518D\u6B21\u89E6\u53D1proxy\u7684get\u65B9\u6CD5 \u4ECE\u800C\u6536\u96C6\u5230getter\u4E2D\u62FF\u5230\u7684\u5C5E\u6027\n        // \u76F4\u63A5\u4F7F\u7528target[key]\u7684\u8BDD  \u53D6alias\u7684\u65F6\u5019\u53EA\u4F1A\u89E6\u53D1\u4E00\u6B21proxy\u7684get\u65B9\u6CD5 \u6CA1\u6709\u6536\u96C6\u5230\u4F7F\u7528\u4E86name\u5C5E\u6027\n        const res = Reflect.get(target, key, receiver)\n        if (isObject(res)) {\n            return reactive(res)\n        }\n        return res\n    },\n    set(target, key, value, receiver) {\n        const oldValue = target[key]\n        const result = Reflect.set(target, key, value, receiver)\n        if (oldValue !== value) {\n            trigger(target, 'set', key, value, oldValue)\n        }\n        return result\n    }\n}", "import { isObject } from \"@vue/shared\";\nimport { ReactiveFlags, mutableHandler } from './baseHandler'\n\n\n// WeakMap \u53EA\u80FD\u7528\u5BF9\u8C61\u6216Symbol\u5F53\u952E\u540D \u4E0D\u4F1A\u963B\u6B62\u952E\u5BF9\u8C61\u88AB\u5783\u573E\u56DE\u6536\nconst reactiveMap = new WeakMap()\n\nexport function reactive(target) {\n    if (!isObject(target)) {\n        return\n    }\n    // \u5DF2\u7ECF\u88ABreactive\u4EE3\u7406\u8FC7\u7684 \u8FD4\u56DE\u81EA\u5DF1\n    if (target[ReactiveFlags.IS_REACTIVE]) {\n        return target\n    }\n    // \u540C\u4E00\u4E2A\u503C\u591A\u6B21\u8C03\u7528 \u8FD4\u56DE\u540C\u4E00\u4E2Aproxy\n    const existingProxy = reactiveMap.get(target)\n    if (existingProxy) {\n        return existingProxy\n    }\n    const proxy = new Proxy(target, mutableHandler)\n    reactiveMap.set(target, proxy)\n    return proxy\n}"],
  "mappings": "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",
  "names": []
}
